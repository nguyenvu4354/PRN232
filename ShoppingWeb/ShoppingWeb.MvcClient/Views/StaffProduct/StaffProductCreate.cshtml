@{
    ViewData["Title"] = "Thêm sản phẩm (Staff)";
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
}
<h2>Thêm sản phẩm</h2>
<form id="createForm" enctype="multipart/form-data">
    <div class="mb-3">
        <label>Tên sản phẩm</label>
        <input type="text" class="form-control" name="Product.ProductName" required />
    </div>
    <div class="mb-3">
        <label>Giá</label>
        <input type="number" class="form-control" name="Product.Price" required />
    </div>
    <div class="mb-3">
        <label>Số lượng</label>
        <input type="number" class="form-control" name="Product.StockQuantity" required />
    </div>
    <div class="mb-3">
        <label>Brand</label>
        <select class="form-control" name="Product.BrandName" id="brandSelect" required></select>
    </div>
    <div class="mb-3">
        <label>Category</label>
        <select class="form-control" name="Product.CategoryName" id="categorySelect" required></select>
    </div>
    <div class="mb-3">
        <label>Ảnh sản phẩm</label>
        <input type="file" class="form-control" name="Product.ImageFile" accept="image/*" />
    </div>
    <button type="submit" class="btn btn-success">Thêm</button>
    <a href="@Url.Action("StaffProductList", "StaffProduct")" class="btn btn-secondary">Quay lại</a>
</form>
@section Scripts {
<script>
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
}
    // Load brand/category
    document.addEventListener('DOMContentLoaded', function () {
        const token = getCookie('AccessToken');
        fetch('https://localhost:7168/api/BrandManagement', {
            headers: { 'Authorization': 'Bearer ' + token },
            credentials: 'include'
        })
        .then(r => r.json())
        .then(data => {
            let html = '';
            data.forEach(b => html += `<option value='${b.id}'>${b.name}</option>`);
            document.getElementById('brandSelect').innerHTML = html;
        });
        fetch('https://localhost:7168/api/CategoriesManagement', {
            headers: { 'Authorization': 'Bearer ' + token },
            credentials: 'include'
        })
        .then(r => r.json())
        .then(data => {
            let html = '';
            data.forEach(c => html += `<option value='${c.id}'>${c.name}</option>`);
            document.getElementById('categorySelect').innerHTML = html;
        });
    });
    // Submit form
    document.getElementById('createForm').onsubmit = function(e) {
        e.preventDefault();
        var formData = new FormData(this);
                fetch('https://localhost:7168/api/ProductsManagement', {
            method: 'POST',
            body: formData,
            credentials: 'include'
        })
        .then(res => {
            if(res.ok) window.location.href = '/StaffProduct/StaffProductList';
            else alert('Thêm sản phẩm thất bại!');
        });
    }
</script>
} 