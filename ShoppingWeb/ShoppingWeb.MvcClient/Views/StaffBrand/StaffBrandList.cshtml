@{
    ViewData["Title"] = "Quản lý thương hiệu (Staff)";
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
}

<h2>Quản lý thương hiệu</h2>
<div class="mb-3">
    <a class="btn btn-success" href="@Url.Action("StaffBrandCreate", "StaffBrand")">+ Thêm thương hiệu</a>
</div>
<table class="table table-bordered" id="brandTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Tên thương hiệu</th>
            <th>Mô tả</th>
            <th>Hành động</th>
            <th>Trạng thái</th>
        </tr>
    </thead>
    <tbody>
        <!-- Thương hiệu sẽ được render bằng JS -->
    </tbody>
</table>
@section Scripts {
<script>
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
    document.addEventListener('DOMContentLoaded', function () {
        const token = getCookie('token');
        fetch('https://localhost:7168/api/BrandManagement', {
            headers: {
                'Authorization': 'Bearer ' + token
            },
            credentials: 'include'
        })
        .then(res => {
            if (!res.ok) throw new Error('HTTP status ' + res.status);
            return res.json();
        })
        .then(data => renderBrands(data));
    });
    function renderBrands(brands) {
        let html = '';
        brands.forEach(brand => {
            html += `<tr>
                <td>${brand.id}</td>
                <td>${brand.name}</td>
                <td>${brand.description || ''}</td>
                <td>${brand.isDisabled ? 'Ẩn' : 'Hiện'}</td>
                <td>
                    <a class='btn btn-primary btn-sm' href='/StaffBrand/StaffBrandEdit/${brand.id}'>Sửa</a>
                    <button class='btn btn-${brand.isDisabled ? 'success' : 'danger'} btn-sm' onclick='toggleDisable(${brand.id}, ${!brand.isDisabled})'>${brand.isDisabled ? 'Hiện' : 'Ẩn'}</button>
                </td>
            </tr>`;
        });
        document.querySelector('#brandTable tbody').innerHTML = html;
    }
    function toggleDisable(id, disable) {
        fetch(`https://localhost:7168/api/BrandManagement/disable/${id}?disable=${disable}`, {
            method: 'PUT',
            headers: { 'Authorization': 'Bearer ' + getCookie('AccessToken') },
            credentials: 'include'
        })
        .then(res => {
            if(res.ok) location.reload();
            else alert('Thao tác thất bại!');
        });
    }
</script>
} 