@{
    ViewData["Title"] = "Quản lý danh mục (Staff)";
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
}

<h2>Quản lý danh mục</h2>
<div class="mb-3">
    <a class="btn btn-success" href="@Url.Action("StaffCategoryCreate", "StaffCategory")">+ Thêm danh mục</a>
</div>
<table class="table table-bordered" id="categoryTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Tên danh mục</th>
            <th>Mô tả</th>
            <th>Hành động</th>
            <th>Trạng thái</th>
        </tr>
    </thead>
    <tbody>
        <!-- Danh mục sẽ được render bằng JS -->
    </tbody>
</table>
@section Scripts {
<script>
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
    document.addEventListener('DOMContentLoaded', function () {
        const token = getCookie('token');
        fetch('https://localhost:7168/api/CategoriesManagement', {
            headers: {
                'Authorization': 'Bearer ' + token
            },
            credentials: 'include'
        })
        .then(res => {
            if (!res.ok) throw new Error('HTTP status ' + res.status);
            return res.json();
        })
        .then(data => renderCategories(data));
    });
    function renderCategories(categories) {
        let html = '';
        categories.forEach(category => {
            html += `<tr>
                <td>${category.id}</td>
                <td>${category.name}</td>
                <td>${category.description || ''}</td>
                <td>${category.isDisabled ? 'Ẩn' : 'Hiện'}</td>
                <td>
                    <a class='btn btn-primary btn-sm' href='/StaffCategory/StaffCategoryEdit/${category.id}'>Sửa</a>
                    <button class='btn btn-${category.isDisabled ? 'success' : 'danger'} btn-sm' onclick='toggleDisable(${category.id}, ${!category.isDisabled})'>${category.isDisabled ? 'Hiện' : 'Ẩn'}</button>
                </td>
            </tr>`;
        });
        document.querySelector('#categoryTable tbody').innerHTML = html;
    }
    function toggleDisable(id, disable) {
        fetch(`https://localhost:7168/api/CategoriesManagement/disable/${id}?disable=${disable}`, {
            method: 'PUT',
            headers: { 'Authorization': 'Bearer ' + getCookie('AccessToken') },
            credentials: 'include'
        })
        .then(res => {
            if(res.ok) location.reload();
            else alert('Thao tác thất bại!');
        });
    }
</script>
} 